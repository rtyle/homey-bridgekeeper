<div>
  <h1 data-i18n="pair.filters.title">Filter Devices</h1>
  <p data-i18n="pair.filters.description">Narrow peer device selection by Zone and Class</p>
  
  <div class="form-group">
    <label data-i18n="pair.filters.zone">Zones:</label>
    <div id="zones" class="checkbox-container"></div>
  </div>
  
  <div class="form-group">
    <label data-i18n="pair.filters.class">Classes:</label>
    <div id="classes" class="checkbox-container"></div>
  </div>
</div>

<style>
.checkbox-container {
  border: 1px solid #ccc;
  padding: 8px;
  margin-top: 4px;
}

.checkbox-item input {
  margin-right: 4px;
  vertical-align: middle;
}
</style>

<script>
(function() {
  const zonesElement = document.getElementById('zones');
  const classesElement = document.getElementById('classes');

  // get selected zones and classes from the back-end, and system lists of such,
  // to initialize the front-end
  Promise.all([
    Homey.emit('get_zones'),
    Homey.emit('get_classes'),
    Homey.emit('list_zones'),
    Homey.emit('list_classes')
  ]).then(([zones, classes, zoneList, classList]) => {
    zonesElement.innerHTML = zoneList.map((item, index) => {
      return `<div class="checkbox-item">
        <input type="checkbox" id="zone-${index}" value="${item.id}" class="zone-checkbox" ${zones.includes(item.id) ? 'checked' : ''}>
        <label for="zone-${index}">${item.name}</label>
      </div>`;
    }).join('');  
    classesElement.innerHTML = classList.map((item, index) => {
      return `<div class="checkbox-item">
        <input type="checkbox" id="class-${index}" value="${item.id}" class="class-checkbox" ${classes.includes(item.id) ? 'checked' : ''}>
        <label for="class-${index}">${item.name}</label>
      </div>`;
    }).join('');
  });

  // forward all changes to selections to the back-end
  function getSelection(className) {
    return Array.from(document.querySelectorAll(`.${className}:checked`))
      .map(cb => cb.value);
  }
  zonesElement.addEventListener('change', (e) => Homey.emit('set_zones', getSelection('zone-checkbox')));
  classesElement.addEventListener('change', (e) => Homey.emit('set_classes', getSelection('class-checkbox')));
})();
</script>